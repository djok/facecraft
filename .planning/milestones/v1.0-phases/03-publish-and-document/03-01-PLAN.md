---
phase: 03-publish-and-document
plan: 01
type: execute
wave: 1
depends_on: []
files_modified: []
autonomous: false

user_setup:
  - service: docker-hub
    why: "Push images to Docker Hub registry"
    env_vars: []
    dashboard_config:
      - task: "docker login with write-access credentials for djok namespace"
        location: "Terminal — run docker login (interactive, or use --password-stdin with PAT)"

must_haves:
  truths:
    - "djok/facecraft:cpu is pullable from Docker Hub"
    - "djok/facecraft:gpu is pullable from Docker Hub"
    - "No :latest tag exists on Docker Hub"
  artifacts:
    - path: "Docker Hub: djok/facecraft:cpu"
      provides: "CPU image available on registry"
    - path: "Docker Hub: djok/facecraft:gpu"
      provides: "GPU image available on registry"
  key_links:
    - from: "local djok/facecraft:cpu"
      to: "Docker Hub djok/facecraft:cpu"
      via: "docker push"
      pattern: "docker push djok/facecraft:cpu"
    - from: "local djok/facecraft:gpu"
      to: "Docker Hub djok/facecraft:gpu"
      via: "docker push"
      pattern: "docker push djok/facecraft:gpu"
---

<objective>
Push both Docker images to Docker Hub under the djok/facecraft repository.

Purpose: Make the images publicly available so any developer can `docker pull djok/facecraft:cpu` (or :gpu) and run Facecraft immediately.
Output: Both tags live on Docker Hub, pullable and verified.
</objective>

<execution_context>
@/home/rosen/.claude/get-shit-done/workflows/execute-plan.md
@/home/rosen/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-publish-and-document/03-RESEARCH.md
</context>

<tasks>

<task type="checkpoint:human-action" gate="blocking">
  <name>Task 1: Authenticate to Docker Hub</name>
  <action>
    The user must authenticate to Docker Hub before images can be pushed.
    Claude cannot perform this step because it requires the user's credentials.
  </action>
  <instructions>
    Run one of these commands in your terminal:

    **Option A — Interactive login:**
    ```bash
    docker login
    ```
    Enter username `djok` and your password or Personal Access Token (PAT).

    **Option B — PAT via stdin (avoids password in shell history):**
    ```bash
    echo "$DOCKER_HUB_PAT" | docker login --username djok --password-stdin
    ```

    **Verify login succeeded:**
    ```bash
    docker info | grep Username
    ```
    Should show `Username: djok`.

    If using a PAT, ensure it has "Read & Write" scope (not just "Read").
  </instructions>
  <resume-signal>Type "logged in" once docker login succeeds, or paste the error if it fails</resume-signal>
</task>

<task type="auto">
  <name>Task 2: Push CPU and GPU images to Docker Hub</name>
  <files></files>
  <action>
    Push both images to Docker Hub. Push CPU first (4.08 GB, faster feedback), then GPU (13.8 GB, longer upload).

    1. Verify both images exist locally:
       ```bash
       docker images djok/facecraft --format "{{.Repository}}:{{.Tag}} {{.Size}}"
       ```
       Must show both `djok/facecraft:cpu` and `djok/facecraft:gpu`.

    2. Push CPU image:
       ```bash
       docker push djok/facecraft:cpu
       ```
       Wait for completion. Verify success (exit code 0, no "denied" errors).

    3. Push GPU image:
       ```bash
       docker push djok/facecraft:gpu
       ```
       This will take significantly longer due to ~13.8 GB size. If it fails mid-upload, re-run the same command (Docker skips already-uploaded layers).

    4. Verify both tags are on Docker Hub by pulling manifest info:
       ```bash
       docker manifest inspect djok/facecraft:cpu > /dev/null 2>&1 && echo "cpu: OK" || echo "cpu: FAIL"
       docker manifest inspect djok/facecraft:gpu > /dev/null 2>&1 && echo "gpu: OK" || echo "gpu: FAIL"
       ```

    IMPORTANT: Do NOT push a `:latest` tag. Only `:cpu` and `:gpu` per locked decision.
  </action>
  <verify>
    `docker manifest inspect djok/facecraft:cpu` succeeds (exit code 0).
    `docker manifest inspect djok/facecraft:gpu` succeeds (exit code 0).
  </verify>
  <done>Both djok/facecraft:cpu and djok/facecraft:gpu are live on Docker Hub and manifest-inspectable.</done>
</task>

</tasks>

<verification>
- `docker manifest inspect djok/facecraft:cpu` returns manifest JSON
- `docker manifest inspect djok/facecraft:gpu` returns manifest JSON
- No `:latest` tag pushed (verify: `docker manifest inspect djok/facecraft:latest` should FAIL)
</verification>

<success_criteria>
Both `:cpu` and `:gpu` tags are publicly available on Docker Hub under `djok/facecraft`. A fresh machine can run `docker pull djok/facecraft:cpu` successfully.
</success_criteria>

<output>
After completion, create `.planning/phases/03-publish-and-document/03-01-SUMMARY.md`
</output>
