---
phase: 03-publish-and-document
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - README.md
autonomous: true

must_haves:
  truths:
    - "README opens with docker pull/run one-liner before any other content"
    - "README contains CPU vs GPU performance benchmark table with hardware specs"
    - "README contains complete environment variable reference table (all FACECRAFT_* vars)"
    - "README contains bundled models inventory table with file names and sizes"
    - "README contains image size transparency section with uncompressed sizes"
    - "README contains volume mount examples for data persistence"
    - "README contains API endpoint overview with curl examples"
  artifacts:
    - path: "README.md"
      provides: "Hub-first documentation with all seven DOCS requirements"
      min_lines: 200
      contains: "docker pull djok/facecraft"
  key_links:
    - from: "README.md quickstart"
      to: "Docker Hub djok/facecraft:cpu"
      via: "docker run command"
      pattern: "docker run.*djok/facecraft:cpu"
    - from: "README.md compose section"
      to: "docker-compose.yml"
      via: "compose commands"
      pattern: "docker compose --profile"
---

<objective>
Rewrite README.md as a Hub-first document where pulling and running from Docker Hub is the primary path.

Purpose: Any developer landing on the repo or Docker Hub page gets everything they need to run Facecraft in 30 seconds, with complete reference material for all configuration, models, and API endpoints.
Output: Rewritten README.md satisfying requirements DOCS-01 through DOCS-07.
</objective>

<execution_context>
@/home/rosen/.claude/get-shit-done/workflows/execute-plan.md
@/home/rosen/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-publish-and-document/03-RESEARCH.md
@README.md
@docker-compose.yml
@src/facecraft/core/config.py
@src/facecraft/api/routes/health.py
@src/facecraft/api/routes/process.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Rewrite README.md with Hub-first structure</name>
  <files>README.md</files>
  <action>
    Read the existing README.md, then rewrite it completely with the following structure. Preserve all existing benchmark data and technical details -- restructure, do not recreate from scratch. Write in clear, concise English.

    **Section order (mandatory):**

    1. **Title + one-line description**
       `# Facecraft` followed by: "AI-powered portrait processing API with background removal, face detection, alignment, and enhancement."

    2. **Quick Start** (DOCS-01)
       Open with the Docker Hub pull one-liner. Show BOTH CPU and GPU variants:
       ```
       docker run -p 8000:8000 djok/facecraft:cpu
       ```
       ```
       docker run --gpus all -p 8000:8000 djok/facecraft:gpu
       ```
       Then show a quick health check curl and a quick image processing curl.
       Include link to interactive docs at http://localhost:8000/docs.

    3. **Performance** (DOCS-04)
       CPU vs GPU benchmark table. Include the hardware specs inline (AMD Ryzen 9 7900, RTX 4090, 32GB DDR5).
       Use the existing benchmark data: CPU ~1.45s, GPU ~0.43s, 3.4x speedup.
       Include the detailed per-test results. Add recommendations (dev=CPU, production=GPU).

    4. **API Endpoints** (DOCS-06)
       Table of all endpoints with method, path, description.
       Endpoints: `/health`, `/ready`, `/status`, `/api/v1/process`, `/api/v1/process/quick`, `/api/v1/process/batch`, `/api/v1/download/{job_id}/{format}`, `/api/v1/jobs/{job_id}`.
       Then show curl examples for:
       - Health check
       - Quick processing (returns PNG directly)
       - Full processing with custom options (width, height, background color, face margin)
       - Batch processing
       Include a Python example and a JavaScript/fetch example (from existing README).

    5. **Environment Variables** (DOCS-02)
       Complete table of ALL `FACECRAFT_*` variables from config.py. Use the full list from the research doc (27 variables). Columns: Variable | Default | Description.
       Group them logically: Server, Processing Defaults, Model Paths, Storage, Limits, Security.

    6. **Bundled Models** (DOCS-03)
       Table with columns: Model | File | Size | Purpose.
       - dlib shape_predictor_68_face_landmarks.dat | ~95 MB | Face landmark detection (68 points)
       - CodeFormer codeformer.pth | ~350 MB | AI face quality enhancement
       - u2net_human_seg.onnx | ~170 MB | Background removal segmentation
       Note: "All models are bundled in the Docker image. No downloads on first run."

    7. **Image Sizes** (DOCS-07)
       Table: Tag | Uncompressed | Contents breakdown.
       - `djok/facecraft:cpu` | 4.08 GB | PyTorch 2.0.1 CPU (~1.8 GB) + models (~615 MB) + runtime
       - `djok/facecraft:gpu` | 13.8 GB | CUDA 12.1 runtime + PyTorch+CUDA (~5.9 GB) + models (~615 MB)
       Add note: "All models are bundled -- no internet access required at runtime."
       Leave compressed Hub sizes as TBD (will be updated after push).

    8. **Volumes and Data Persistence** (DOCS-05)
       Show named volume examples for uploads and processed output:
       ```
       docker run -p 8000:8000 -v facecraft-uploads:/app/uploads -v facecraft-output:/app/processed djok/facecraft:cpu
       ```
       Show bind mount example for local directory access.
       Reference docker-compose.yml which already has named volumes configured.

    9. **Docker Compose**
       Show the profile-based usage:
       ```
       docker compose --profile cpu up -d
       docker compose --profile gpu up -d
       ```
       Note: both profiles share port 8000, run only one at a time.

    10. **Development** (local setup without Docker -- keep existing content, move to bottom)
        - venv setup, pip install, model download note, uvicorn command

    11. **License and Acknowledgments** (keep existing)

    **Writing rules:**
    - No build instructions in Quick Start -- Hub pull is the primary path
    - Every code block must specify the language (bash, python, javascript)
    - Keep it under 20KB (Docker Hub full_description limit is 25KB)
    - Use backtick formatting for all CLI commands, env vars, endpoints, file paths
    - Do not add emojis
  </action>
  <verify>
    1. `head -30 README.md` shows title, description, and Quick Start with `docker run -p 8000:8000 djok/facecraft:cpu`
    2. `grep -c "FACECRAFT_" README.md` returns at least 25 (all env vars present)
    3. `grep "djok/facecraft:cpu" README.md` finds at least 3 occurrences (quickstart, image sizes, compose)
    4. `grep "1.45" README.md` finds benchmark data preserved
    5. `wc -c README.md` is under 25000 bytes
    6. Sections present: Quick Start, Performance, API Endpoints, Environment Variables, Bundled Models, Image Sizes, Volumes, Docker Compose, Development, License
  </verify>
  <done>
    README.md is rewritten with Hub-first quickstart as the opening content. Contains all seven DOCS requirements: env var reference table (DOCS-02), bundled models inventory (DOCS-03), performance benchmarks (DOCS-04), volume mount examples (DOCS-05), API endpoint overview with curl examples (DOCS-06), and image size transparency (DOCS-07). Under 25KB total.
  </done>
</task>

</tasks>

<verification>
- README.md starts with `# Facecraft` and within the first 20 lines shows `docker run -p 8000:8000 djok/facecraft:cpu`
- All 7 DOCS requirements covered (search for each section header)
- Environment variable table has 25+ entries
- Bundled models table has 3 rows (dlib, CodeFormer, u2net)
- Image sizes section shows 4.08 GB and 13.8 GB
- Volume mount examples present
- File size under 25,000 bytes
</verification>

<success_criteria>
The README opens with a working `docker run` one-liner and performance benchmarks. It contains complete environment variable reference, bundled models inventory, image size transparency, volume mount examples, and API endpoint overview with curl examples. Total file size is under 25KB for Docker Hub compatibility.
</success_criteria>

<output>
After completion, create `.planning/phases/03-publish-and-document/03-02-SUMMARY.md`
</output>
